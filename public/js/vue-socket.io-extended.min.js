!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueSocketIOExt=e()}(this,function(){"use strict";var t=function(t){return"function"==typeof t},e=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return e.reduce(function(t,e){return e(t)},t)}},n=function(t){return function(e){return t+e}},r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},s=function(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n},c=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},a=new(function(){function e(){r(this,e),this.listeners=new Map}return o(e,[{key:"addListener",value:function(e,n,r){t(n)&&(this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push({callback:n,vm:r}))}},{key:"removeListener",value:function(e,n,r){if(t(n)){var o=(this.listeners.get(e)||[]).filter(function(t){return t.callback!==n||t.vm!==r});o.length>0?this.listeners.set(e,o):this.listeners.delete(e)}}},{key:"emit",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];(this.listeners.get(t)||[]).forEach(function(t){var e;(e=t.callback).call.apply(e,[t.vm].concat(n))})}}]),e}()),u=function(t){return t.split("/").pop()},f=Object.freeze({actionPrefix:"socket_",mutationPrefix:"SOCKET_",eventToMutationTransformer:function(t){return t.toUpperCase()},eventToActionTransformer:function(t,e){e=Object.assign({pascalCase:!1},e);var n=function(t){return e.pascalCase?t.charAt(0).toUpperCase()+t.slice(1):t};return 0===(t=Array.isArray(t)?t.map(function(t){return t.trim()}).filter(function(t){return t.length}).join("-"):t.trim()).length?"":1===t.length?e.pascalCase?t.toUpperCase():t.toLowerCase():/^[a-z\d]+$/.test(t)?n(t):(t!==t.toLowerCase()&&(t=function(t){for(var e=!1,n=!1,r=!1,o=0;o<t.length;o++){var i=t[o];e&&/[a-zA-Z]/.test(i)&&i.toUpperCase()===i?(t=t.slice(0,o)+"-"+t.slice(o),e=!1,r=n,n=!0,o++):n&&r&&/[a-zA-Z]/.test(i)&&i.toLowerCase()===i?(t=t.slice(0,o-1)+"-"+t.slice(o-1),r=n,n=!1,e=!0):(e=i.toLowerCase()===i,r=n,n=i.toUpperCase()===i)}return t}(t)),n(t=t.replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,function(t,e){return e.toUpperCase()})))}}),l=["connect","error","disconnect","reconnect","reconnect_attempt","reconnecting","reconnect_error","reconnect_failed","connect_error","connect_timeout","connecting","ping","pong"],p=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.store,c=s(n,["store"]);r(this,t),this.Socket=e,this.options=i({},f,c),o&&(this.store=o),this.registerEventHandler()}return o(t,[{key:"registerEventHandler",value:function(){var t=this,e=this.Socket.onevent;this.Socket.onevent=function(n){e.call(t.Socket,n),a.emit.apply(a,c(n.data));var r,o=(r=n.data,Array.isArray(r)?r:Array.from(r)),i=o[0],s=o.slice(1);t.passToStore(i,[].concat(c(s)))},l.forEach(function(e){t.Socket.on(e,function(){for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];a.emit.apply(a,[e].concat(r)),t.passToStore(e,[].concat(r))})})}},{key:"passToStore",value:function(t,r){var o=this;if(this.store){var i,s,c=(i=r)&&i.length<=1?i[0]:i,a=e(this.options.eventToActionTransformer,n(this.options.actionPrefix)),f=e(this.options.eventToMutationTransformer,n(this.options.mutationPrefix))(t),l=a(t),p=(s=this.store,Object.keys(s._mutations)),h=function(t){return Object.keys(t._actions)}(this.store);p.filter(function(t){return u(t)===f}).forEach(function(t){return o.store.commit(t,c)}),h.filter(function(t){return u(t)===l}).forEach(function(t){return o.store.dispatch(t,c)})}}}]),t}();var h,v="undefined"!=typeof Proxy&&("function"==typeof(h=Proxy)&&/native code/.test(h.toString()));return{install:function(e,n,r){if(!((o=n)&&t(o.on)&&t(o.emit)))throw new Error("[vue-socket.io-ext] you have to pass `socket.io-client` instance to the plugin");var o,i=new p(n,r);e.prototype.$socket=i.Socket,e.mixin(function(t){return{created:function(){var e=this,n=this.$options.sockets,r=void 0===n?{}:n;Object.keys(r).forEach(function(n){t.addListener(n,r[n],e)}),v&&(this.$options.sockets=new Proxy(r,{set:function(n,r,o){return t.addListener(r,o,e),n[r]=o,!0},deleteProperty:function(n,r){return t.removeListener(r,e.$options.sockets[r],e),delete n.key,!0}}))},beforeDestroy:function(){var e=this,n=this.$options.sockets,r=void 0===n?{}:n;Object.keys(r).forEach(function(n){v||t.removeListener(n,r[n],e),delete e.$options.sockets[n]})}}}(a))},defaults:f}});
